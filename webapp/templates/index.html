<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Quartalsreport Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
      <span id="theme-icon">üåô</span>
    </button>
    <main class="container">
      <h1>Quartalsreport Generator</h1>

      <!-- Report Type Selector -->
      <section class="card">
        <h2>Report-Konfiguration</h2>
        <div class="tabs">
          <button class="tab-btn active" data-tab="standard">Standard Quartalsreport</button>
          <button class="tab-btn" data-tab="flexible">Flexibler Report</button>
          <button class="tab-btn" data-tab="admin">Admin</button>
        </div>
      </section>

      <!-- Standard Quarterly Report Form -->
      <section id="standard-form" class="card tab-content active">
        <form id="upload-form-standard">
          <div class="field">
            <label for="csv-file">CSV (Soll/Ist, optional bei hinterlegter Standard-CSV)</label>
            <input id="csv-file" name="csv_file" type="file" accept=".csv" />
          </div>
          <div class="field">
            <label for="xml-file">XML (Zeiteintr√§ge, Mehrfachauswahl m√∂glich)</label>
            <input id="xml-file" name="xml_file" type="file" accept=".xml" multiple required />
          </div>
          <div class="field">
            <label for="quarter">Quartal (optional, z. B. 2025Q3)</label>
            <input id="quarter" name="quarter" type="text" placeholder="Auto-Auswahl" />
          </div>
          <button id="submit-btn-standard" type="submit">Report erzeugen</button>
        </form>
      </section>

      <!-- Flexible Report Form -->
      <section id="flexible-form" class="card tab-content">
        <form id="upload-form-flexible">
          <!-- File Uploads -->
          <div class="form-section">
            <h3>Dateien</h3>
            <div class="field">
              <label for="csv-file-flex">CSV (Soll/Ist)</label>
              <input id="csv-file-flex" name="csv_file" type="file" accept=".csv" required />
            </div>
            <div class="field">
              <label for="xml-file-flex">XML (Zeiteintr√§ge)</label>
              <input id="xml-file-flex" name="xml_file" type="file" accept=".xml" required />
            </div>
          </div>

          <!-- Report Type -->
          <div class="form-section">
            <h3>Report-Typ</h3>
            <div class="field">
              <label for="report-type">Typ</label>
              <select id="report-type" name="report_type" required>
                <option value="quarterly">Quartalsreport</option>
                <option value="custom_period" selected>Benutzerdefinierter Zeitraum</option>
                <option value="monthly">Monatsreport</option>
                <option value="yearly">Jahresreport</option>
                <option value="project">Projekt-Zusammenfassung</option>
                <option value="employee">Mitarbeiter-Zusammenfassung</option>
              </select>
            </div>
          </div>

          <!-- Date Range -->
          <div class="form-section">
            <h3>Zeitraum</h3>
            <div class="field-group">
              <div class="field">
                <label for="start-date">Von</label>
                <input id="start-date" name="start_date" type="date" required />
              </div>
              <div class="field">
                <label for="end-date">Bis</label>
                <input id="end-date" name="end_date" type="date" required />
              </div>
            </div>
          </div>

          <!-- Time Grouping -->
          <div class="form-section">
            <h3>Zeitliche Gliederung</h3>
            <div class="field">
              <label for="time-grouping">Gliederung</label>
              <select id="time-grouping" name="time_grouping" required>
                <option value="monthly">Nach Monaten getrennt</option>
                <option value="period" selected>Ein zusammenh√§ngender Block</option>
                <option value="weekly">Nach Wochen</option>
                <option value="none">Keine Gliederung (Gesamtsumme)</option>
              </select>
            </div>
            <p class="help-text">
              <strong>Nach Monaten:</strong> Separate Bl√∂cke f√ºr jeden Monat<br>
              <strong>Ein Block:</strong> z.B. "15.08-15.09" als ein Block<br>
              <strong>Nach Wochen:</strong> Wochenweise Unterteilung<br>
              <strong>Keine Gliederung:</strong> Nur Gesamtsumme
            </p>
          </div>

          <!-- Optional Filters -->
          <div class="form-section">
            <h3>Filter (optional)</h3>
            <div class="field">
              <label>
                <input type="checkbox" id="filter-projects" name="filter_projects" />
                Nur bestimmte Projekte
              </label>
              <div id="project-filter-section" class="filter-section hidden">
                <input
                  type="text"
                  id="projects"
                  name="projects"
                  placeholder="Projekt-Codes kommagetrennt, z.B. 0283.05, 0299.02"
                />
                <p class="help-text">Mehrere Projekte mit Komma trennen</p>
              </div>
            </div>
            <div class="field">
              <label>
                <input type="checkbox" id="filter-employees" name="filter_employees" />
                Nur bestimmte Mitarbeiter
              </label>
              <div id="employee-filter-section" class="filter-section hidden">
                <input
                  type="text"
                  id="employees"
                  name="employees"
                  placeholder="Namen kommagetrennt, z.B. C. Trapp SV, A. Kokott"
                />
                <p class="help-text">Mehrere Mitarbeiter mit Komma trennen</p>
              </div>
            </div>
          </div>

          <!-- Report Options -->
          <div class="form-section">
            <h3>Report-Optionen</h3>
            <div class="field">
              <label>
                <input type="checkbox" id="include-bonus" name="include_bonus_calc" checked />
                Bonus-Berechnung einschlie√üen
              </label>
            </div>
            <div class="field">
              <label>
                <input type="checkbox" id="include-budget" name="include_budget_overview" checked />
                Budget-√úbersicht einschlie√üen
              </label>
            </div>
            <div class="field">
              <label>
                <input type="checkbox" id="include-summary" name="include_summary_sheet" checked />
                Zusammenfassungsblatt einschlie√üen
              </label>
            </div>
            <div class="field">
              <label>
                <input type="checkbox" id="exclude-special" name="exclude_special_projects" />
                Sonderprojekte (0000, 0.1000) ausschlie√üen
              </label>
            </div>
          </div>

          <button id="submit-btn-flexible" type="submit">Flexiblen Report erzeugen</button>
        </form>
      </section>

      <!-- Admin Panel -->
      <section id="admin-form" class="card tab-content">
        <!-- Login overlay -->
        <div id="admin-login" class="admin-section">
          <h3>Admin-Zugang</h3>
          <div class="field">
            <label for="admin-user">Benutzername</label>
            <input id="admin-user" type="text" autocomplete="username" />
          </div>
          <div class="field">
            <label for="admin-password">Passwort</label>
            <input id="admin-password" type="password" autocomplete="current-password" />
          </div>
          <button id="admin-login-btn" type="button">Anmelden</button>
          <div id="admin-login-error" class="error hidden">Ung√ºltige Zugangsdaten.</div>
        </div>

        <!-- Admin content (shown after login) -->
        <div id="admin-content" class="hidden">

          <!-- Budget CSV -->
          <div class="admin-section">
            <h3>Zentrale Budget-CSV</h3>
            <div id="budget-info" class="admin-info-box">Lade...</div>
            <div class="field">
              <label for="admin-csv-file">Neue CSV hochladen</label>
              <input id="admin-csv-file" type="file" accept=".csv" />
            </div>
            <button id="admin-csv-upload-btn" type="button">CSV aktualisieren</button>
            <div id="admin-csv-msg" class="admin-msg hidden"></div>
          </div>

          <!-- OTA Update -->
          <div class="admin-section">
            <h3>System-Update</h3>
            <p class="help-text">
              ZIP-Datei erstellen mit: <code>git archive HEAD --format=zip &gt; update.zip</code><br>
              Nach dem Upload erkennt uvicorn die √Ñnderungen automatisch (~3 Sekunden).
            </p>
            <div class="field">
              <label for="admin-update-file">Update-ZIP hochladen</label>
              <input id="admin-update-file" type="file" accept=".zip" />
            </div>
            <button id="admin-update-btn" type="button">Update einspielen</button>
            <div id="admin-update-msg" class="admin-msg hidden"></div>
          </div>

          <button id="admin-logout-btn" type="button" class="btn-secondary">Abmelden</button>
        </div>
      </section>

      <section id="status-card" class="card hidden">
        <h2>Status</h2>
        <div class="status-line">
          <span id="status-message">Warte auf Start...</span>
        </div>
        <div class="progress">
          <div id="progress-bar"></div>
        </div>
        <div class="status-line">
          <span>Warteschlange:</span>
          <span id="queue-position">-</span>
        </div>
        <div id="error-box" class="error hidden"></div>
        <div id="download-box" class="hidden">
          <div id="download-list">
            <a id="download-link" class="download-link"></a>
          </div>
          <button id="reset-btn" type="button">Neuen Report starten</button>
        </div>
      </section>
    </main>
    <script src="/static/app-flexible.js"></script>
    <script src="/static/app-admin.js"></script>
  </body>
</html>
